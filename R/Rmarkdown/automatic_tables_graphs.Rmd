---
title: "Trend in fisheries"
author: "WGEEL"
date: "29 september 2025"
output: 
   bookdown::word_document2:
     keep_md: yes
     toc: yes
     number_sections: no
     reference_docx: "ICES_template.docx"
test: "`r paste('_metadata.yaml')`"
---
\newline
```{r setup, include=TRUE, echo=FALSE, warnings=FALSE}
# replace word_document or html_document

#--------------------------------
# get your current name 
#--------------------------------
getUsername <- function(){
  name <- Sys.info()[["user"]]
  return(name)
}
#--------------------------------
addSmallLegend <- function(myPlot, pointSize = 1, textSize = 6, spaceLegend = 1) {
    myPlot +
        guides(shape = guide_legend(override.aes = list(size = pointSize)),
               color = guide_legend(override.aes = list(size = pointSize)),
               fill = guide_legend(override.aes = list(size = pointSize))) +
        theme(legend.title = element_text(size = textSize), 
              legend.text  = element_text(size = textSize),
              legend.key.size = unit(spaceLegend, "lines"))
}


flextable2ICES <- function(x){
  x |>
    font(fontname = "Calibri", part = "all") |>
    fontsize(size = 8.5, part = "all") |>
    bold(part = "header") |>
    flextable::align(align = "left", part = "all") |>
    flextable::border(part = "all", 
                      border.top = fp_border(color = "black", width = 0.5),
                      border.bottom = fp_border(color = "black", width = 0.5)) |>
    bg(bg = "#B7D1C3", part = "header") |>
    style(pr_p=fp_par(padding = 2),
          part = "all") |>
    style(pr_p=fp_par(padding = 2,
                      border = fp_border(width = 0, col = "#B7D1C3", style = "none")),
          part = "header") |>
    flextable::valign(part = "body", valign = "top") |>
  colformat_double(big.mark = ",", digits = 1) |>
  colformat_num(j = 1, big.mark = "", digits = 0) |>
  flextable::align(align = "right", part = "body") |>
  flextable::align(j = 1, align = "center", part = "body") |>
  flextable::align(align = "center", part = "header") |>
        set_table_properties(width = 1, layout = "fixed") |>
flextable::autofit()
}


if (getUsername() == "phja0001") setwd("\\\\storage-og.slu.se\\home$\\phja0001\\My Documents\\Philip\\Researcher SLU\\Eel\\ICES\\2025\\wg_WGEEL_2025\\R\\Rmarkdown")
if (getUsername() == "hdrouineau") setwd("~/Documents/Bordeaux/migrateurs/WGEEL/github/wg_WGEEL/R/Rmarkdown/")
if (getUsername() == "cedric.briand") setwd("C:/workspace/wg_WGEEL/R/Rmarkdown") 
if (getUsername() == "cboulenger") setwd("C:/Users/cboulenger/Documents/wg_WGEEL/R/Rmarkdown") 

CY=2025 # this should be set to the current year, yellow eel data will be analysed up to CY-1
library(stringr)
imgwd <- str_c(getwd(),"/",CY,"/00international/image/")
tabwd <- str_c(getwd(),"/",CY,"/00international/table/")
datawd <- str_c(getwd(),"/",CY,"/00international/data/")
dir.create(imgwd, showWarnings = FALSE)
dir.create(tabwd, showWarnings = FALSE)
dir.create(datawd, showWarnings = FALSE)

knitr::opts_chunk$set(echo = TRUE, warnings=FALSE, error = TRUE)
knitr::opts_knit$set(root.dir = getwd())
options(dplyr.summarise.inform = FALSE) #remove warnings of summarize
#source("R/utilities/set_directory.R")
#data_directory <- wg_choose.dir(caption = "Where do you want to save the tables and the graphs")
#data_directory <-"C:/temp"
#knitr::opts_knit$set(root.dir = data_directory)

render="html"  # html 
# temporary file to store the variables (this is necessary to print the text)

# to test the output and adapt the type of table
output <- rmarkdown::metadata$output

# TO RUN THIS SCRIPT YOU FIRST NEED TO UPDATE THE SHINY DV DATA. THERE IS A BUTTON ALSO IN SHINY_DV TO DO THAT
# wg_WGEEL\R\shiny_data_visualisation\shiny_dv
```





```{r load_utilities, eval=TRUE, echo=FALSE,include=FALSE}

source("../utilities/load_library.R")

#-----------------
# other libraries
#-----------------
load_package("hues")
load_package("readxl")
load_package("stringr")
load_package("reshape2")
load_package("tidyr") # unite cols in maps
load_package("rlang")
load_package("flextable")
load_package("officer")

load_package("sp")
#load_package("pool")
#load_package("DBI")
load_package("RPostgreSQL")
load_package("dplyr")
load_package("RColorBrewer")
load_package("sqldf")
load_package("scales")
load_package('stringr') # text handling
#load_package("XLConnect") # for excel
load_package("ggplot2") # for excel
load_package("gridExtra")
load_package("colorspace")
load_package("ggrepel")
load_package("patchwork")

load_package("viridis")
load_package("svglite")
load_package("leaflet.minicharts")
load_package("glue")
load_package("kableExtra")
load_package("yaml")
load_package("grid")
load_package("ggmagnify")
library("ggmagnify")
#install.packages("remotes")
#remotes::install_github("hughjonesd/ggmagnify")


# load functions ------------------------------------------------------------------------------------
# retrieve reference tables needed
# the shiny is launched from shiny_data_integration/shiny thus we need the ../
if(is.null(options()$sqldf.RPostgreSQL.user)) {
  wd <-getwd()
  setwd("../shiny_data_visualisation/shiny_dv")
  source("database_connection.R")
  source("database_reference.R")
  source("database_data.R")
  source("database_precodata.R")
  source("preco_diagram.R")
  source("graphs.R")
  source("maps.R")
  source("filter_and_group_functions.R")
  source("predict_missing.R")
  setwd(wd)
}

# loading datasets 

# this file is added to the ignore list, so ask for it in your own git before launching the app
#habitat_ref <- extract_ref("Habitat type")
#lfs_code_base <- extract_ref("Life stage")
##lfs_code_base <- lfs_code_base[!lfs_code_base$lfs_code %in% c("OG","QG"),]
#country_ref <- extract_ref("Country")
#country_ref <- country_ref[order(country_ref$cou_order), ]
#country_ref$cou_code <- factor(country_ref$cou_code, levels = country_ref$cou_code[order(country_ref$cou_order)], ordered = TRUE)

##have an order for the emu
#emu_ref <- extract_ref("EMU")
#emu_cou<-merge(emu_ref,country_ref,by.x="emu_cou_code",by.y="cou_code")
#emu_cou<-emu_cou[order(emu_cou$cou_order,emu_cou$emu_nameshort),]
#emu_cou<-data.frame(emu_cou,emu_order=1:nrow(emu_cou))
## Extract data from the database -------------------------------------------------------------------
# cedric 2020 : ATTENTION LOAD shiny_di version database_interaction version uses different names
#landings = extract_data("landings",quality=c(1,2,4),quality_check=TRUE)
#aquaculture = extract_data("aquaculture",quality=c(1,2,4),quality_check=TRUE)
#release = extract_data("release",quality=c(1,2,4),quality_check=TRUE)
# this file is added to the ignore list, so ask for it in your own git before launching the app
load("../shiny_data_visualisation/shiny_dv/data/maps_for_shiny.Rdata") 
# now data are generated by the script load_data_from_the_database.R
load("../shiny_data_visualisation/shiny_dv/data/ref_and_eel_data.Rdata")
## Download the colors by country

# coeffy increases ylim by about coeffy to let more space for subgraph
subplot <- function(grob, coeffy, minyear=2009, xmin=2000, xmax= Inf, ymin=5000, ymax=Inf, ymaxbox=5000){
  sub <- grob +
      scale_x_continuous(limits=c(minyear,CY+1),breaks= pretty_breaks()) +
      theme(legend.position = "none",  
          rect = element_rect(fill = "transparent"),					
          plot.background = element_rect(fill = "transparent",colour = NA))#,
  #axis.title.y=element_blank(),
  #axis.text.y=element_blank(),
  #axis.ticks.y=element_blank())
  grob2 <- grob +	
      annotate("rect",xmin=minyear+.5,xmax=CY+0.5, ymin=0, ymax=ymaxbox,fill="transparent",col="black")+
      scale_y_continuous(limits=c(0,pretty(layer_scales(grob)$y$range$range[2]*coeffy)))+
      annotation_custom(ggplotGrob(sub),xmin=xmin,xmax=xmax,ymin=ymin, ymax=ymax)
  return(grob2)
}

values=c(RColorBrewer::brewer.pal(12,"Set3"),
    RColorBrewer::brewer.pal(12, "Paired"), 
    RColorBrewer::brewer.pal(8,"Accent"),
    RColorBrewer::brewer.pal(8, "Dark2"))
color_countries = setNames(values,country_ref$cou_code)

library("hues")
swatch(colours()[1:10])
iwanthue(5, 0, 240, 0, 24, 0, 100, plot=TRUE) # shades
iwanthue(5, 0, 360, 0, 54, 67, 100, plot=TRUE) # pastel
iwanthue(5, 0, 360, 54, 180, 27, 67, plot=TRUE) # pimp
iwanthue(5, 0, 360, 36, 180, 13, 73, plot=TRUE) # intense
iwanthue(3, 0, 300, 60, 180, 73, 100, plot=TRUE) # fluoro
iwanthue(3, 220, 260, 12, 150, 0, 53, plot=TRUE) # blue ocean



#' fun.agg
#' aggregation of a table
#' @param X table to aggregate
#' @param conversion (1000 to convert kg to tons, 1e6 to convert
#' nb to millions)
#'
#' @return aggregated table
#' @export
#'
fun.agg<-function(X, conversion=1000){
  if(length(X)>0){round(sum(X)/conversion,ifelse(sum(X)>conversion,1,1))}else{sum(c(X,NA))}
}

```

# Key numbers

### Glass eel landings
```{r keyNumbersLandingsG, results="asis", eval=TRUE, echo=FALSE}

landings_all<-filter_data("landings",		typ = 4)%>% dplyr::filter(is.na(eel_missvaluequal))
select_land<-aggregate(landings_all$eel_value,by=list(landings_all$eel_year,landings_all$eel_lfs_code),sum,na.rm=T)
g_CY<-round(select_land$x[select_land$Group.1==CY & select_land$Group.2=="G"]/1000,2)
g_CY1<-round(select_land$x[select_land$Group.1==CY-1 & select_land$Group.2=="G"]/1000,2)
g_mean_CY2_CY6<-mean(round(select_land$x[select_land$Group.1 %in% c((CY-6):(CY-2)) & select_land$Group.2=="G"]/1000,2))
cou_G_CY<-unique(landings_all$eel_cou_code[landings_all$eel_year==CY & is.na(landings_all$eel_missvaluequal) & landings_all$eel_lfs_code=="G"])
cou_G_CY1<-unique(landings_all$eel_cou_code[landings_all$eel_year==CY-1 & is.na(landings_all$eel_missvaluequal) & landings_all$eel_lfs_code=="G"])

save(g_CY, g_CY1, g_mean_CY2_CY6, cou_G_CY, cou_G_CY1, file = paste0(datawd,
                                                                     "key_figures_landDGE.Rdata"))
```

- Glass eel commercial fisheries within the EU in `r CY-1`: `r round(g_CY1)`t , countries where data were reported: `r paste(cou_G_CY1,sep="", collapse=",")`
- Glass eel commercial fisheries within the EU in `r CY`:  `r round(g_CY)`t, countries where data were reported: `r paste(cou_G_CY,sep="", collapse=",")`
- Mean glass eel commercial fisheries for the previous 5 years (`r CY-6`-`r CY-2`) within the EU = `r round(g_mean_CY2_CY6)`t.

\newline

### Yellow and Silver com eels landings
```{r keyNumbersLandingsYS, results="asis", eval=TRUE, echo=FALSE}

landings_YS<-filter_data("landings",		typ = 4,
    life_stage = c("Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
select_land_YS<-aggregate(landings_YS$eel_value,by=list(landings_YS$eel_year),sum,na.rm=T)
YS_CY1<-round(sum(select_land_YS$x[select_land_YS$Group.1==CY-1]/1000),2)
YS_CY2<-round(select_land_YS$x[select_land_YS$Group.1==CY-2]/1000,2)
YS_meanCY3_CY7<-mean(round(select_land_YS$x[select_land_YS$Group.1 %in% c((CY-7):(CY-3))]/1000,2))
nb_cou_Y_CY1<-length(unique(landings_YS$eel_cou_code[landings_YS$eel_year==CY-1 & is.na(landings_YS$eel_missvaluequal)]))
nb_cou_Y_CY2<-length(unique(landings_YS$eel_cou_code[landings_YS$eel_year==CY-2 & is.na(landings_YS$eel_missvaluequal)]))

year<-unique(landings_YS$eel_year)
country<-unique(landings_YS$eel_cou_code)
hty<-unique(landings_YS$eel_hty_code)
grouped_data <-group_data(landings_YS,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,1,1))}else{sum(c(X,NA))}}
grouped_data$eel_cou_code = as.factor(grouped_data$eel_cou_code)                       
grouped_data <- predict_missing_values(grouped_data, verbose=FALSE, na.rm=FALSE)
select_corr_land_YS<-aggregate(grouped_data$eel_value,by=list(grouped_data$eel_year),sum,na.rm=T)
YS_corr_CY2<-round(select_corr_land_YS$x[select_corr_land_YS$Group.1==CY-2]/1000,2)
YS_corr_CY1<-round(select_corr_land_YS$x[select_corr_land_YS$Group.1==CY-1]/1000,2)
YS_corr_mean_CY3_CY7<-mean(round(select_corr_land_YS$x[select_corr_land_YS$Group.1 %in% c((CY-7):(CY-3))]/1000,2))



save(YS_CY1, YS_CY2, YS_meanCY3_CY7, nb_cou_Y_CY1, nb_cou_Y_CY2,
     YS_corr_CY2, YS_corr_CY1, YS_corr_mean_CY3_CY7,
     file = paste0(datawd, 
                    "key_figures_landDYS.Rdata"))
```

- Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in `r CY-2`: `r round(YS_CY2)`t, number of countries reporting: `r nb_cou_Y_CY2`
- Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in `r CY-1`: `r round(YS_CY1)`t, number of countries reporting: `r nb_cou_Y_CY1`
- Mean Yellow and Silver eel commercial fisheries for the previous 5 years (`r CY-7`-`r CY-3`) within the EU: `r round(YS_meanCY3_CY7)`t

- Reconstructed Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in `r CY-2`: `r round(YS_corr_CY2)` t.
- Reconstructed Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in `r CY-1`: `r round(YS_corr_CY1)`t.
- Mean Reconstructed Yellow and Silver eel commercial fisheries for the previous 5 years (`r CY-7`-`r CY-3`) within the EU: `r round(YS_corr_mean_CY3_CY7)`t.


### Glass eel recreational landings

```{r keyNumbersRecLandings_G, results="asis", eval=TRUE, echo=FALSE}
landings_rec<-filter_data("landings",		typ = 6)%>% dplyr::filter(is.na(eel_missvaluequal))
select_rec<-aggregate(landings_rec$eel_value,by=list(landings_rec$eel_year,landings_rec$eel_lfs_code),sum,na.rm=T)
rec_G_CY<-round(select_rec$x[select_rec$Group.1==CY & select_rec$Group.2=="G"]/1000,2)
rec_G_CY1<-round(select_rec$x[select_rec$Group.1==CY-1 & select_rec$Group.2=="G"]/1000,2)
rec_mean_G_CY2_CY6<-mean(round(select_rec$x[select_rec$Group.1 %in% c((CY-6):(CY-2)) & select_rec$Group.2=="G"]/1000,2))
rec_cou_G_CY<-unique(landings_rec$eel_cou_code[landings_rec$eel_year==CY & is.na(landings_rec$eel_missvaluequal) & landings_rec$eel_lfs_code=="G"])
rec_cou_G_CY1<-unique(landings_rec$eel_cou_code[landings_rec$eel_year==CY-1 & is.na(landings_rec$eel_missvaluequal) & landings_rec$eel_lfs_code=="G"])

# mean(round(select_rec$x[select_rec$Group.1 %in% c(1978:2009) & select_rec$Group.2=="G"]/1000,2))
# mean(round(select_rec$x[select_rec$Group.1 %in% c(2010:2019) & select_rec$Group.2=="G"]/1000,2))
save(rec_G_CY, rec_G_CY1, rec_mean_G_CY2_CY6, rec_cou_G_CY1, 
     file = paste0(datawd, 
                    "key_figures_reclandDG.Rdata"))

```


- Glass eel recreational fisheries within the EU in `r CY-1`: `r round(rec_G_CY1)`t, countries where data were reported: `r paste(rec_cou_G_CY1,sep="", collapse=", ")`
- Glass eel recreational fisheries within the EU in `r CY`: `r round(rec_G_CY)`t, countries where data were reported: `r paste((rec_cou_G_CY),sep="", collapse=", ")`
- Mean glass eel recreational fisheries for the previous 5 years (`r CY-6`-`r CY-2`) within the EU: `r round(rec_mean_G_CY2_CY6)`t

### Yellow and Silver eel recreational landings

```{r keyNumbersRecLandingsYS, results="asis", eval=TRUE, echo=FALSE}

landings_YS_rec<-filter_data("landings",		typ = 6,
    life_stage = c("Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
select_land_YS_rec<-aggregate(landings_YS_rec$eel_value,by=list(landings_YS_rec$eel_year),sum,na.rm=T)
YS_CY1_rec<-round(sum(select_land_YS_rec$x[select_land_YS_rec$Group.1==CY-1]/1000,2))
YS_CY2_rec<-round(select_land_YS_rec$x[select_land_YS_rec$Group.1==CY-2]/1000,2)
YS_mean_rec_CY3_CY7<-mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c((CY-7):(CY-3))]/1000,2))
nb_cou_YS_CY1_rec<-length(unique(landings_YS_rec$eel_cou_code[landings_YS_rec$eel_year==CY-1 & is.na(landings_YS_rec$eel_missvaluequal)]))
nb_cou_YS_CY2_rec<-length(unique(landings_YS_rec$eel_cou_code[landings_YS_rec$eel_year==CY-2 & is.na(landings_YS_rec$eel_missvaluequal)]))



# landings_YS_rec<-filter_data("landings",		typ = 6,
# 		life_stage = c("G","Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
# select_land_YS_rec<-aggregate(landings_YS_rec$eel_value,by=list(landings_YS_rec$eel_year),sum,na.rm=T)
# mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c(1978:1990)]/1000,2))
# mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c(2009:2018)]/1000,2))
# mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c(2019)]/1000,2))
save(YS_CY1_rec, YS_CY2_rec, YS_mean_rec_CY3_CY7, nb_cou_YS_CY1_rec, nb_cou_YS_CY2_rec,
     file = paste0(datawd, 
                    "key_figures_reclandDYS.Rdata"))

```



- Yellow and Silver eel recreational fisheries within the EU (Y, S, YS) in `r CY-2`: `r round(YS_CY2_rec)`t, number of countries reporting: `r nb_cou_YS_CY2_rec`
- Yellow and Silver eel recreational fisheries within the EU (Y, S, YS) in `r CY-1`: `r round(YS_CY1_rec)`t, number of countries reporting: `r nb_cou_YS_CY1_rec`
- Mean Yellow and Silver eel recreational fisheries for the previous 5 years (`r CY-7`-`r CY-3`) within the EU: `r round(YS_mean_rec_CY3_CY7)`t.

### Aquaculture
Data reported in the yearly Data Call are incomplete and WGEEL considers that they are not reliable 
to track the trend in aquaculture. Till 2016, the WGEEL used to 
report these figures from other sources, including FAO and FEAP 
(Federation of European Aquaculture Producers). While those sources
might not include aquaculture production for restocking, they could still be used
to inform on the trend. WGEEL comments that, while aquaculture production on itself
has no impact on the stock, part of the fisheries of wild individuals aim to seed
the aquaculture, and as such, the demand for aquaculture remains a pressure on the
stock.


```{r keNumbersAquaculture, results="asis", eval=FALSE, echo=FALSE}
aqua<-filter_data("aquaculture", typ = 11)%>% dplyr::filter(is.na(eel_missvaluequal))
select_aqua<-aggregate(aqua$eel_value,by=list(aqua$eel_year),sum,na.rm=T)
aqua_CY2<-round(select_aqua$x[select_aqua$Group.1==CY-2]/1000,2)
aqua_mean_CY3_CY7 <- round(mean(select_aqua$x[select_aqua$Group.1 %in% c((CY-7):(CY-3))]/1000,2))
aqua_cou_CY2<-unique(aqua$eel_cou_code[aqua$eel_year==CY-2 & is.na(aqua$eel_missvaluequal)])

save(aqua_CY2, aqua_mean_CY3_CY7, aqua_cou_CY2, 
     file = paste0(datawd, 
                    "key_figures_aquaculture.Rdata"))

```



### Release

```{r keyNumbersRelease, results="asis", eval=TRUE, echo=FALSE}
rel <- filter_data("release",
    typ = 9,
    life_stage = c("G","QG","Y","S"),
    year=1950:CY-1)%>% dplyr::filter(is.na(eel_missvaluequal))

select_rel <- aggregate(rel$eel_value,by=list(rel$eel_year,rel$eel_lfs_code),sum,na.rm=T)
rel_CY_G <- round(sum(select_rel$x[select_rel$Group.1==CY & select_rel$Group.2 %in% c("G","QG")])/10^6,2)
rel_CY1_G <- round(sum(select_rel$x[select_rel$Group.1==CY-1 & select_rel$Group.2 %in% c("G","QG")])/10^6,2)
rel_CY2_G <- round(sum(select_rel$x[select_rel$Group.1==CY-2 & select_rel$Group.2 %in% c("G","QG")])/10^6,2)
rel_CY1_Y <- round(select_rel$x[select_rel$Group.1==CY-1 & select_rel$Group.2=="Y"]/10^6,2)
rel_CY1_S <- round(select_rel$x[select_rel$Group.1==CY-1 & select_rel$Group.2=="S"]/10^6,2)
rel_CY2_Y <- round(select_rel$x[select_rel$Group.1==CY-2 & select_rel$Group.2=="Y"]/10^6,2)
rel_CY2_S <- round(select_rel$x[select_rel$Group.1==CY-2 & select_rel$Group.2=="S"]/10^6,2)
cou_CY_relG <- length(unique(rel$eel_cou_code[rel$eel_year==CY & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code %in% c("G","QG")]))
cou_CY1_relG <- length(unique(rel$eel_cou_code[rel$eel_year==CY-1 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code %in% c("G","QG")]))
cou_CY2_relG <- length(unique(rel$eel_cou_code[rel$eel_year==CY-2 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code %in% c("G","QG")]))
cou_CY1_relY <- length(unique(rel$eel_cou_code[rel$eel_year==CY-1 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code=="Y"]))
cou_CY2_relY <- length(unique(rel$eel_cou_code[rel$eel_year==CY-2 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code=="Y"]))
cou_CY1_relS <- length(unique(rel$eel_cou_code[rel$eel_year==CY-1 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code=="S"]))
cou_CY2_relS <- length(unique(rel$eel_cou_code[rel$eel_year==CY-2 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code=="S"]))


```




- Number of glass eels (G, QG) released in `r CY-2`: `r round(rel_CY2_G)` millions, number of countries reporting: `r paste(cou_CY2_relG,sep="", collapse=", ")`
- Number of glass eels (G, QG) released in `r CY-1`: `r round(rel_CY1_G)` millions, number of countries reporting: `r paste(cou_CY1_relG,sep="", collapse=", ")`
- Number of glass eels (G, QG) released in `r CY`: `r round (rel_CY_G)` millions, data incomplete, number of countries reporting: `r paste(cou_CY_relG,sep="", collapse=", ")`
- Number of yellow eels (Y) released in `r `CY-1`: `r round(rel_CY1_Y)` millions, number of countries reporting: `r paste(cou_CY1_relY,sep="", collapse=", ")`
- Number of yellow eels (Y) released in `r CY-2`: `r round(rel_CY1_Y)` millions, number of countries reporting: `r paste(cou_CY2_relY,sep="", collapse=", ")`
- Number of silver eels (S) released in `r CY-1`: `r round(rel_CY1_S)` millions, number of countries reporting: `r paste(cou_CY1_relS,sep="", collapse=", ")`
- Number of silver eels (S) released in `r CY-2`: `r round(rel_CY2_S)` millions, number of countries reporting: `r  paste(cou_CY2_relS,sep="", collapse=", ")`


```{r keyNumbersReleasekg, results="asis", eval=TRUE, echo=FALSE}
rel_kg <- filter_data("release",
    typ = 8,
    life_stage = c("G","QG","Y","S"),
    year=1950:CY-1)%>% dplyr::filter(is.na(eel_missvaluequal))

select_rel_kg <- aggregate(rel_kg$eel_value,by=list(rel_kg$eel_year,rel_kg$eel_lfs_code),sum,na.rm=T)
rel_CY_G_t <- round(sum(select_rel_kg$x[select_rel_kg$Group.1==CY & select_rel_kg$Group.2 %in% c("G","QG")])/10^3,2)
rel_CY1_G_t <- round(sum(select_rel_kg$x[select_rel_kg$Group.1==CY-1 & select_rel_kg$Group.2 %in% c("G","QG")])/10^3,2)
rel_CY2_G_t <- round(sum(select_rel_kg$x[select_rel_kg$Group.1==CY-2 & select_rel_kg$Group.2 %in% c("G","QG")])/10^3,2)
rel_CY1_Y_t <- round(select_rel_kg$x[select_rel_kg$Group.1==CY-1 & select_rel_kg$Group.2=="Y"]/10^3,2)
rel_CY1_S_t <- round(select_rel_kg$x[select_rel_kg$Group.1==CY-1 & select_rel_kg$Group.2=="S"]/10^3,2)
rel_CY2_Y_t <- round(select_rel_kg$x[select_rel_kg$Group.1==CY-2 & select_rel_kg$Group.2=="Y"]/10^3,2)
rel_CY2_S_t <- round(select_rel_kg$x[select_rel_kg$Group.1==CY-2 & select_rel_kg$Group.2=="S"]/10^3,2)
cou_CY_relG_t <- length(unique(rel_kg$eel_cou_code[rel_kg$eel_year==CY & is.na(rel_kg$eel_missvaluequal) & rel_kg$eel_lfs_code %in% c("G","QG")]))
cou_CY1_relG_t <- length(unique(rel_kg$eel_cou_code[rel_kg$eel_year==CY-1 & is.na(rel_kg$eel_missvaluequal) & rel_kg$eel_lfs_code %in% c("G","QG")]))
cou_CY2_relG_t <- length(unique(rel_kg$eel_cou_code[rel_kg$eel_year==CY-2 & is.na(rel_kg$eel_missvaluequal) & rel_kg$eel_lfs_code %in% c("G","QG")]))
cou_CY1_relY_t <- length(unique(rel_kg$eel_cou_code[rel_kg$eel_year==CY-1 & is.na(rel_kg$eel_missvaluequal) & rel_kg$eel_lfs_code=="Y"]))
cou_CY2_relY_t <- length(unique(rel_kg$eel_cou_code[rel_kg$eel_year==CY-2 & is.na(rel_kg$eel_missvaluequal) & rel_kg$eel_lfs_code=="Y"]))
cou_CY1_relS_t <- length(unique(rel_kg$eel_cou_code[rel_kg$eel_year==CY-1 & is.na(rel_kg$eel_missvaluequal) & rel_kg$eel_lfs_code=="S"]))
cou_CY2_relS_t <- length(unique(rel_kg$eel_cou_code[rel_kg$eel_year==CY-2 & is.na(rel_kg$eel_missvaluequal) & rel_kg$eel_lfs_code=="S"]))


save(rel_CY_G_t, rel_CY1_G_t, rel_CY2_G_t, rel_CY1_Y_t, rel_CY1_S_t,
     rel_CY2_Y_t, rel_CY2_S_t, cou_CY_relG_t,
     file = paste0(datawd, 
                    "key_figures_releases.Rdata"))
```


- Quantity of glass eels (G, QG) released in `r CY-2`: `r round(rel_CY2_G_t)`t, number of countries reporting: `r paste(cou_CY2_relG_t,sep="", collapse=", ")`
- Quantity of glass eels (G, QG) released in `r CY-1`: `r round(rel_CY1_G_t)`t, number of countries reporting: `r  paste(cou_CY1_relG_t,sep="", collapse=", ")`
- Quantity of glass eels (G, QG) released in `r CY`: `r round(rel_CY_G_t)`t, data incomplete, number of countries reporting: `r paste(cou_CY_relG_t,sep="", collapse=", ")`
- Quantity of yellow eels (Y) released in `r CY-1`: `r round(rel_CY1_Y_t)`t, number of countries reporting: `r paste(cou_CY1_relY_t,sep="", collapse=", ")`
- Quantity of yellow eels (Y) released in `r CY-2`: `r round(rel_CY1_Y_t)`t, number of countries reporting: `r paste(cou_CY2_relY_t,sep="", collapse=", ")`
- Quantity of silver eels (S) released in `r CY-1`: `r round(rel_CY1_S_t)`t, number of countries reporting: `r  paste(cou_CY1_relS_t,sep="", collapse=", ")`
- Quantity of silver eels (S) released in `r CY-2`: `r round(rel_CY2_S_t)`t, number of countries reporting: `r  paste(cou_CY2_relS_t,sep="", collapse=", ")`

# Trend in fisheries

This section presents and describes data from commercial, recreational and
non-commercial fisheries, aquaculture production and restocking of eel. Data can
be reported by eel life stage (glass, yellow, silver), habitat type (freshwater,
transitional, coastal, marine), and by eel management unit (EMU) where possible.
Historical series for which these details are not available are reported by
country. The current database structure allows aggregation by country or EMU.
The data presented are those reported to the yearly ICES WGEEL through data calls.

## Commercial fisheries landings

Care should be taken with the interpretation of the landings as indicators of
the stock, since the landings statistics also reflect changes in effort as well
as of stock levels. In addition, landings data presented here might be
incomplete due to a lack of reporting by countries. In summary, reported
commercial landings are declining from a level of approximately 10,000 t in the 1960s
to `r round(YS_CY1 + g_CY1, -1) ` tonnes in `r CY-1` (glass
eel + yellow eel + silver eel).

### Glass eel



```{r comLandGt,echo=FALSE, warning=FALSE}

##raw commercial landings for Glass eel and every country

filtered_data <- filter_data("landings",
    typ = 4,
    life_stage = "G",
    country=c("ES","FR","IT","PT","GB")
) %>% dplyr::filter(is.na(eel_missvaluequal)) # removing data from Ireland
year <- unique(filtered_data$eel_year)
country <- unique(filtered_data$eel_cou_code)
hty <- unique(filtered_data$eel_hty_code)
grouped_data  <- group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##table
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1000)
table <- data.frame(table,total=rowSums(table[,-1],na.rm=T))



#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order  <-  n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableComLandG<-table

caption <- paste("Table 1:  Glass eel commercial fisheries landings (in tonnes) from 1984 to ",max(year),", reported by countries: ",
                 get_country_table(tableComLandG), ".", sep="")

ka_com_land_G <- kable(format(table,digt=1,drop0trailing=TRUE),
    format="pandoc",caption = caption)

ka_com_land_G <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 1"), paste(":  Glass eel commercial fisheries landings (in tonnes) from 1984 to ",max(year),", reported by countries: ",
                 get_country_table(tableComLandG), ".", sep="")),
              style = "Normal", align_with_table = FALSE)



```

Figure \@ref(fig:corrComGfig) presents the time-series up to and including
`r CY` for total commercial glass eel landings as reported by
`r ncol(tableComLandG)-2` countries in the Eel Data call
(`r paste(names(tableComLandG)[-c(1,ncol(tableComLandG))], collapse = ", ")`),
including reconstructed data to fill data gaps. In Spain, part of the former Basque recreational
fishery was recommissioned as a commercial fishery following the ban of recreational
fisheries.

Glass eel landings show a sharp decline since 1980 from 2,000 t to about 40–60
t since 2009 onwards. In `r CY`, the raw (uncorrected) landings data for glass
eels is `r tableComLandG$total[tableComLandG$Year==CY]` t, while it was
`r tableComLandG$total[tableComLandG$Year==(CY-1)]` t in `r CY-1` (Annex XXX
Table XXX for raw data and Table XXX for raw and corrected data). 






```{r comlandGfig, echo=FALSE, warning=FALSE, fig.cap=titleG, fig.height=5, fig.width=10, eval=FALSE}

landings3<-grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code = as.factor(landings3$eel_cou_code)
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
landings3$eel_cou_code <- droplevels(landings3$eel_cou_code)
color_countries2 <- color_countries[names(color_countries)%in%levels(landings3$eel_cou_code)]
GCY <-	landings3%>%filter(eel_year==CY)%>%
    group_by(eel_year)%>%
    summarize(s=sum(eel_value,na.rm=TRUE))%>%
    pull(s)

GCYm1 <- landings3%>%
    filter(eel_year==CY-1)%>%
    group_by(eel_year)%>%
    summarize(s=sum(eel_value,na.rm=TRUE))%>%
    pull(s)
cou_string <- get_country(data=landings3)
##Graph
titleG <- paste("Time-series of reported commercial glass eel fishery landings (tonnes) by country. To fill data gaps, non-reported countries/years combinations were reconstructed.", cou_string ,"are included combining information from the Data Call", CY, "and the WGEEL database updated to", CY, ". The Portuguese catches correspond to glass eel catches from the Portuguese side of the Miño river. Catches from the Spanish side of the Miño river are included in the Spanish catches.")
#vvv$G_total_CY <- sprintf("%0.2f tons",GCY)





# title <- paste("Commercial landings for glass eel in all habitats")
# g_raw_Clandings_G<- ggplot(landings3) + 
#     geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
#     xlab("year") + 
#     ylab("Glass eel landings (tonnes)")+
#     #ggtitle(title)+
#     scale_fill_manual("Country",values=color_countries2)+
#    theme_bw()
# #print(g_raw_Clandings_G)
# print(g_raw_Clandings_G<- subplot(g_raw_Clandings_G,
#         coeffy=1, # no need to increase the scale
#         minyear=2009, 
#         xmin=1985, 
#         xmax= Inf, 
#         ymin=500,
#         ymax=Inf,
#         ymaxbox=70))
# 
# 
# g_raw_Clandings_G



```

\newline

```{r corrComG, echo=FALSE, warning=FALSE}


# corrected landings
filtered_data<-filter_data("landings",
    typ = 4,
    life_stage = "G", 
    year_range = 1970:CY,
    country=c("ES","FR","IT","PT","GB"))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,1,1))}else{sum(c(X,NA))}}
grouped_data$eel_cou_code = as.factor(grouped_data$eel_cou_code)                       
landings3 <- predict_missing_values(grouped_data, verbose=FALSE, na.rm=FALSE) 
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
landings3$eel_cou_code <- droplevels(landings3$eel_cou_code)
color_countries2 <- color_countries[names(color_countries)%in%levels(landings3$eel_cou_code)]
landings_year<-aggregate(eel_value~eel_year, landings3, sum)
table = dcast(landings3, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1000)
table2=dcast(landings3, eel_year~eel_cou_code, value.var = "predicted",fun = prod)
```

```{r corrComGt, echo=FALSE, warning=FALSE}
#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]

#add a column with the sum of all the values and prod of predicted

table<-data.frame(table,total=rowSums(table[,-1],na.rm = TRUE))
table2<-data.frame(table2,prod=apply(table2[,-1],1,prod,na.rm = TRUE))

#add a * when the data is predicted

for (col in 2:ncol(table)){
  table[,col][table2[,col]==0]<-paste0(table[,col][table2[,col]==0],"*")
}


# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableCorLandYS<-table
ka_cor_com_land_G <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Raw+ corr commercial landings (tonnes) for yellow and silver eels  ","(",min(year),"-",max(year),")"," for ",paste(paste(country,collapse=","), ".", sep="")))



```
    
```{r corrComGfig, echo=FALSE, warning=FALSE, fig.cap=titleGcor, fig_height=8, fig_width=8}

color_countries4<- c(
  "NO" = "#66c2a5",  # Norway #FFFFB3
  "SE" = "#BEBADA",  # Sweden 
  "FI" = "#80B1D3",  # Finland 
  "EE" = "#FDB462",  # Estonia 
  "LV" = "#B3DE69",  # Latvia 
  "LT" = "#BC80BD",  # Lithuania
  "PL" = "#FCCDE5",  # Poland 
  "CZ" = "#999999",  # Czech Republic 
  "DE" = "#FFED6F",  # Germany
  "DK" = "#A6CEE3",  # Denmark 
  "NL" = "#FF7F00",  # Netherlands 
  "BE" = "#984ea3",  # Belgium 
  "IE" = "#228B22",  # Ireland ##FB9A99 (Pink)
  "GB" = "#F0027F",  # United Kingdom ("#E31A1C") #DB7093 (it is ok)
  "FR" = "#FDBF6F",  # France 
  "ES" = "#1F78B4",  # Spain 
  "PT" = "#999999",  # Portugal 
  "IT" = "#A6761D",  # Italy , #A6761D
  "SI" = "#6A3D9A",  # Slovenia,  #B15928
  "HR" = "#7FC97F",  # Croatia 
  "AL" = "#FFFF99",  # Albania 
  "GR" = "#b3b3b3",  # Greece , #b3b3b3
  "TR" = "#DB7093",  # Turkey 
  "LY" = "#e5c494",  # Libya 
  "TN" = "#386CB0",  # Tunisia 
  "DZ" = "#E6AB02",  # Algeria 
  "MA" = "#B15928"   # Morocco #B15928
)



landings3$eel_value <- landings3$eel_value/10^3
landings3$eel_cou_code <- droplevels(landings3$eel_cou_code)
color_countries2 <- color_countries[names(color_countries)%in%levels(landings3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(landings3$eel_cou_code)]
cou_string <- get_country(data=landings3)
##Graph
titleGcor <- paste0("Time-series of reported or reconstructed commercial glass eel fishery landings (tonnes) by country. To fill data gaps, non-reported countries/years combinations were reconstructed. ", cou_string ," are included, combining information from the Data Call " , CY, " and the WGEEL database updated to " ,CY, ". The inset box shows the proportion of reconstructed landings per year.")


g_reconstructed_landings <- addSmallLegend(ggplot(landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code),position='stack')+
    xlab("Year") + ylab("Landings (tonnes)")+
    coord_cartesian(expand = FALSE, ylim = c(0, max(landings_year$eel_value)*1.3/1000)) +
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw()+
    geom_magnify(from = c(xmin = 2010, xmax = CY, ymin = 0, ymax = 75),
        to = c(xmin=1990, xmax=2020, ymin=1300, ymax=max(landings_year$eel_value * 1.2/1000)), axes="xy") 
  )

# percentage of original data
g_percentage_reconstructed <- addSmallLegend(ggplot(landings3)+
    geom_col(aes(x=eel_year,y=eel_value,fill=!predicted),position='stack')+
    xlab("") + 
    ylab("")+
    scale_fill_manual(name = "Data", values=c("black","grey"),labels=c("Predicted","Raw"))+
    theme_bw() )

g3_grob <- ggplotGrob(g_percentage_reconstructed)
g_combined_landings_G <-  g_percentage_reconstructed /
  g_reconstructed_landings + patchwork::plot_layout(heights = c(1,3))


print(g_combined_landings_G)


```
<br>


The ratio between reported commercial landings of glass eels and the recruitment
index in Elsewhere Europe provides a relative measure of exploitation rate
(Figure \@ref(fig:fishingmortality)). The analysis was restricted to the
"Elsewhere Europe" area since no commercial glass eel fisheries took place in
the North Sea area in recent years. Moreover, the analysis was restricted to the
post-2000 period for which data are more comprehensive. The exploitation rate
for glass eels has decreased after the implementation of the Eel Regulation in
2009 (Fig, 5) (data for 2009 were removed as France, which accounts for a
significant part of the landings, did not report data for that year) and
remained relatively stable since then. After a peak in 2024, the currently
estimated higher recruitment for 2025 contributes to the lowest exploitation
rate. The exploitation rate can only be estimated for glass eel : since for
yellow eel standing stock and silver eels no reliable abundance estimates are
available to allow comparison with landings


```{r fishingmortality, eval=TRUE, fig.cap="Reported G and GY commercial landings divided by recruitment index for EE (including landings reported in EMUs ES_Astu, ES_Cant, ES_Cata, ES_Minh, ES_Mino, ES_Vale, FR_Adou, FR_Arto, FR_Bret, FR_Garo, FR_Loir, FR_Sein, FR_total, GB_Dee, GB_NorW, GB_Seve, GB_SouE, GB_SouW, GB_Wale, GB_total, IT_Lazi, IT_Tosc, IT_Vene). The resulting ratio was standardised by the mean value till 2008 and  is a relative proxy of the exploitation rate that informs on trends in fishing mortality. Landings data from 2000 are not available for GB. Year 2009 was removed since France, which accounts for a significant part of the landings, did not report data for this year.", fig.width=14/2.54, warning = FALSE, message = FALSE, error=FALSE, echo=FALSE}

knitr::include_graphics(paste0("../recruitment/", CY, "/image/exploitation_rates_GE.png"))


```

<br>



### Yellow and silver eel 

Figure \@ref(fig:rawComLandYSfig) presents aggregated landings data for yellow
and silver eels coming and Figure \@ref(fig:corrComYS)
presents the time-series including reconstructed data to fill data gaps. The
proportion of "corrected" landings was as high as 50% in the 1950s, but rather
low since the mid-1980s. The total landings (including reconstructed) of yellow
and silver eels decreased from 18,000–20,000 t in the 1950s to 2,000–3,500 t
since 2009. Reported landings from yellow and silver eel commercial fisheries
(Y, S, YS) add up to `r round(YS_CY1)` t in `r CY-1` and `r round(YS_CY2)` t in
`r CY-2` (number of countries reporting `r nb_cou_Y_CY1` and `r nb_cou_Y_CY2`).
Yellow and silver eel commercial fisheries averaged `r round(YS_meanCY3_CY7)` t
per year over the five previous years (from `r CY-7` to `r CY-3`). In addition
to the data shown here, WGEEL received landings data from Egypt, but these have not
been incorporated in the analyses as they need evaluation.



```{r rawComLandYSt, echo=FALSE, warning=FALSE}


##raw  com landings for Y S and YS for all the countries

filtered_data<-filter_data("landings",
    typ = 4,
    life_stage = c("Y","S","YS"),
    year_range = 1908:CY-1
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country", habitat=FALSE, lfs=FALSE, na.rm=TRUE)

##table
# fun.agg<-function(X){if(length(X)>0){round(sum(X,na.rm=TRUE)/1000,ifelse(sum(X,na.rm=TRUE)>1000,1,1))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1000)
table<-data.frame(table,total=rowSums(table[,-1],na.rm=T))              
#ordering the column accordign to country order
#country_to_order = names(table)[-1]
#n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
#n_order <- n_order+1
#n_order <- c(1,n_order)
#table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableComLandYS<-table
table1<-table[,c(1,2:12)]
cou_text1 <- get_country_table(table1)
table2<-table[,c(1,13:23)]
cou_text2 <- get_country_table(table2)
table3<-table[,c(1,20:ncol(table))]
cou_text3 <- get_country_table(table3[,-ncol(table3)])
caption <- 

ka_com_land_YS1 <- kable(format(table1,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("part a  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: ", cou_text1," (to be continued for other countries in next table).", sep=""))
ka_com_land_YS2 <- kable(format(table2,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("part b  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 2), reported by countries: ", cou_text2," (to be continued for other countries in next table).", sep=""))
ka_com_land_YS3 <- kable(format(table3,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("part c  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 3), reported by countries: ", cou_text3,".", sep=""))



ka_com_land_YS1 <- flextable(table1) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 2a"), paste(":  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: ", cou_text1," (to be continued for other countries in next table).", sep="")),
              style = "Normal", align_with_table = FALSE)

ka_com_land_YS2 <- flextable(table2) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 2b"), paste(":  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: ", cou_text2," (to be continued for other countries in next table).", sep="")),
              style = "Normal", align_with_table = FALSE)

ka_com_land_YS3 <- flextable(table3) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 2c"), paste(":  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: ", cou_text3," (to be continued for other countries in next table).", sep="")),
              style = "Normal", align_with_table = FALSE)


```

\newline



```{r rawComLandYSfig, echo=FALSE, warning=FALSE, fig.cap=titleY, fig.height=5, fig.width=10}


## Graph
landings3<-grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code = as.factor(landings3$eel_cou_code)
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
YCYm1 <- landings3%>%filter(eel_year==CY-1)%>%group_by(eel_year)%>%summarize(s=sum(eel_value,na.rm=TRUE))%>%pull(s)
landings3$eel_cou_code <- droplevels(landings3$eel_cou_code)
color_countries2 <- color_countries[names(color_countries)%in%levels(landings3$eel_cou_code)]
#vvv$YS_total_CYm1 <- sprintf("%0.1f tons", YCYm1)
#vvv$total <- YCYm1+GCYm1
cou_string <- get_country(data=landings3)
##Graph
titleY <- paste0("Time-series of reported commercial yellow (Y), silver (S) and yellow-silver (YS) eel fishery landings (tonnes) 1908-",CY-1,
    " by country. ", cou_string ," are included, combining information from the Data Call " , CY , " and the WGEEL database updated to ", CY-1,".")

g_raw_Clandings_YS<- ggplot(landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + ylab("Landings (tonnes)")+
    scale_fill_manual("Country",values=color_countries4)+
    theme_bw()+
   geom_magnify(from = c(xmin = 2010, xmax = CY-1, ymin = 0, ymax = 3500),
       to = c(xmin=1996.5, xmax=CY+3, ymin=9000, ymax=13500), axes="xy")

print(g_raw_Clandings_YS)


#print(g_raw_Clandings_YS<-subplot(g_raw_Clandings_YS,
#  coeffy=1.3,
#  minyear=2009, 
#  xmin=1980, 
#  xmax= Inf, 
#   ymin=10000,
#  ymax=Inf,
# ymaxbox=4500))

```




```{r corrComYS, echo=FALSE, warning=FALSE, fig.cap=titleYcor}

##Table raw + corr commercial landings for Yellow eel and every country

filtered_data<-filter_data("landings",
    typ = 4,
    life_stage = c("Y","S","YS"),
    year_range = 1990:CY-1   # 1950:CY-1
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,1,1))}else{sum(c(X,NA))}}
grouped_data$eel_cou_code = as.factor(grouped_data$eel_cou_code)                       
grouped_data <- predict_missing_values(grouped_data, verbose=FALSE, na.rm=FALSE) 
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion=1000)
table2 = dcast(grouped_data, eel_year~eel_cou_code, value.var = "predicted",fun.aggregate = prod)

#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
table2 = table2[, n_order]
#add a column with the sum of all the values and prod of predicted

table<-data.frame(table,total=rowSums(table[,-1],na.rm = TRUE))
table2<-data.frame(table2,prod=apply(table2[,-1],1,prod,na.rm = TRUE))

#add a * when the data is predicted

for (col in 2:ncol(table)){
  table[,col][table2[,col]==0]<-paste0(table[,col][table2[,col]==1],"*")
}

# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableCorLandYS<-table
ka_cor_com_land_YS <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 12: Raw+ corr commercial landings (tonnes) for yellow and silver eels  ","(",min(year),"-",max(year),")"," for ",paste(paste(country,collapse=","), ".", sep="")))


#landings_year <- dataset
landings3<-grouped_data
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
landings_year<-aggregate(eel_value~eel_year, landings3, function(X)sum(X)/1000)
landings3$eel_value <- landings3$eel_value/1000
landings3$eel_cou_code <- droplevels(landings3$eel_cou_code)
color_countries2 <- color_countries[names(color_countries)%in%levels(landings3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(landings3$eel_cou_code)]
cou_string <- get_country(data=landings3)
##Graph
titleYcor <- paste0("Time-series of reported and reconstructed commercial yellow (Y), silver (S) and yellow-silver (YS) eel fishery landings (tonnes) 1989-", CY," by country. To fill data gaps, non-reported countries/years combinations were reconstructed. ", cou_string ," are included, combining information from the Data Call ", CY," and the WGEEL database updated to ", CY-1, ". The inset box shows the proportion of reconstructed landings per year.")


g_reconstructed_landings <- addSmallLegend(ggplot(landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code),position='stack')+ 
    xlab("Year") + ylab("Landings (tonnes)")+
    coord_cartesian(expand = FALSE, ylim = c(0, max(landings_year$eel_value))) +
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw())

# percentage of original data
g_percentage_reconstructed <- addSmallLegend(ggplot(landings3)+
    geom_col(aes(x=eel_year,y=eel_value,fill=!predicted),position='stack')+
    xlab("") + 
    ylab("")+
    scale_fill_manual(name = "Data", values=c("black","grey"),labels=c("Predicted","Raw"))+
    theme_bw())

g3_grob <- ggplotGrob(g_percentage_reconstructed)
g_combined_landings_YS <- g_percentage_reconstructed /
  g_reconstructed_landings + patchwork::plot_layout(heights = c(1,3))
print(g_combined_landings_YS)

```
<br>

## Recreational fisheries
In addition to Regulations described in chapter 1, recreational fisheries in some
countries were banned completely through local
regulations and some
countries restricted the season for recreational fishery in freshwater.


Recreational glass eel fishery landings decreased from over 1000 tonnes in the early
1980s, primarily from France, (Figure \@ref(fig:recLandGfig)) to values below 5 t 
after 2005, with the inset revealing minimal residual catches that ceased in France
in 2010 and in Spain in 2023 following regulatory bans.


Recreational landings of yellow and silver eel combined which summed up to
`r round(YS_CY2_rec)` t for `r CY-2` (`r nb_cou_YS_CY2_rec` countries reporting)
and `r round(YS_CY1_rec)` t for `r CY-1`  (`r nb_cou_YS_CY1_rec` countries
reported - Figure \@ref(fig:recLandYSfig)). France has provided estimation for all freshwater recreational
fisheries in 2006, while for other years, France provided declared catch by
recreational fishers with gear in public rivers. Sweden provided estimations for
some years in the past based on questionnaires and calculations from *Statistics Sweden*.
Belgium data is based on a questionnaire from 2015, and did not update the date since then.
This implies that total recreational catches for certain years are probably
underestimated. The mean landings from yellow and silver eel recreational
fisheries over the previous five years (`r CY-7`–`r CY-3`) were
`r round(YS_mean_rec_CY3_CY7)` t. The data for `r CY-1` is incomplete and will
change since some countries do not report the landings annually (e.g. Germany and Denmark, every 3 years).



```{r recLandG,echo=FALSE, warning=FALSE}

##Table raw rec landings for G for all the countries

filtered_data<-filter_data("landings",
    typ = 6,
    life_stage = "G")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Table
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,1,1))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1000)
table<-data.frame(table,total=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tablerecLandG<-table
#table1<-table[,c(1,14,15,ncol(table))]
table$total<-as.character(table$total)
ka_rec_land_G <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 4: Raw recreational landings (tonnes) for glass eels  ","(",min(year),"-",max(year),")"," for ",paste(get_country_table(table), ".", sep="")))
#ka_rec_land_G1 <- kable(format(table1,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 4:  Glass eel recreational fisheries landings (in tonnes) from ", min(year)," to ",max(year),")",", reported by countries: FR France, ES Spain.", sep=""))




ka_rec_land_G <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 4"), paste(": Raw recreational landings (tonnes) for glass eels  ","(",min(year),"-",max(year),")"," for ",paste(get_country_table(table), ".", sep=""))),
              style = "Normal", align_with_table = FALSE)

```

\newline

```{r recLandGfig, echo=FALSE, warning=FALSE, fig.cap=titleGrec, fig.height=5, fig.width=10}

## Graph
landings3 <- grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code <- as.factor(landings3$eel_cou_code)
landings3$eel_cou_code <- factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
landings3$eel_cou_code <- droplevels(landings3$eel_cou_code)
color_countries2 <- color_countries[names(color_countries)%in%levels(landings3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(landings3$eel_cou_code)]
cou_string <- get_country(data=landings3)
titleGrec <- paste0("Time-series of reported recreational glass eel fishery landings (tonnes), 1978-",CY, " by country, ", cou_string,". Note: Recreational fisheries for glass eel were banned in France in 2010, and in Spain 2023.")

raw_Rlandings_G <- filter(landings3,eel_value>0)
g_raw_Rlandings_G <- ggplot(raw_Rlandings_G) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + 
    ylab("Landings (tonnes)")+
    scale_fill_manual("Country", values=color_countries4plot)+
    theme_bw()+
    geom_magnify(from = c(xmin = 2010, xmax = CY, ymin = 0, ymax = 3),
        to = c(xmin=2000, xmax=CY, ymin=500, ymax=1250), axes="xy")

print(g_raw_Rlandings_G)
#print(g_raw_Rlandings_G<-subplot(g_raw_Rlandings_G,
#       coeffy=1.3,
#      minyear=2000, 
#     xmin=1990, 
#    xmax= Inf, 
#   ymin=400,
#  ymax=Inf,
# ymaxbox=40))
```

<br>
\newline


```{r recLandYSt,echo=FALSE, warning=FALSE}

##Table raw rec landings for Y S and YS for all the countries


filtered_data<-filter_data("landings",
    typ = 6,
    life_stage = c("Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)

grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Table
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,1,1))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion=1000)
table<-data.frame(table,total=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRecLandYS<-table
table1<-table[,c(1,2:12)]
cou_text1 <- get_country_table(table1)
table2<-table[,c(1,13:ncol(table))]
cou_text2 <- get_country_table(table2[,-ncol(table2)])
##ka_rec_land_Y<- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 3: Raw recreational landings (tonnes) for yellow and silver eels  ","(",min(year),"-",max(year),")","for",paste(paste(country,collapse=","), ".", sep="")))
ka_rec_land_Y1<- kable(format(table1,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("part a,  Recreational fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: ", cou_text1," (to be continued for other countries in next table).", sep=""))
ka_rec_land_Y2<-kable(format(table2,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("part b,  Recreational fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 2), reported by countries: ", cou_text2," , total.", sep=""))



ka_rec_land_Y1 <- flextable(table1) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 3a"), paste(": Recreational fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: ", cou_text1," (to be continued for other countries in next table).", sep="")),
              style = "Normal", align_with_table = FALSE)


ka_rec_land_Y2 <- flextable(table2) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 3b"), paste(": Recreational fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: ", cou_text2," (to be continued for other countries in next table).", sep="")),
              style = "Normal", align_with_table = FALSE)


```


\newline


```{r recLandYSfig,echo=FALSE, warning=FALSE, fig.cap=titleYSrec, fig.height=5, fig.width=10}

##Graph
landings3<-grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code = as.factor(landings3$eel_cou_code)
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
landings3$eel_cou_code <- droplevels(landings3$eel_cou_code)
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(landings3$eel_cou_code)]
color_countries2 <- color_countries[names(color_countries)%in%levels(landings3$eel_cou_code)]
cou_string <- get_country(data=landings3)
##Graph
titleYSrec <- paste0("Time-series of reported or estimated recreational yellow and silver eel fishery landings (tonnes), by country. ", cou_string, ".")
#vvv$G_total_CY <- sprintf("%0.2f tons",GCY)

g_raw_Rlandings_YS<- ggplot(filter(landings3,eel_value>0)) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + ylab("Landings (tonnes)")+
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw()+
    guides(fill = guide_legend(ncol = 2))
print(g_raw_Rlandings_YS)



```




## Illegal, unreported and unregulated landings

Illegal, unreported, and unregulated fishing (IUU) is by its nature very
difficult to quantify, and misreporting may therefore be substantial. Organised
illegal glass eel trade is supplied by legally caught and IUU caught eel. This
trade is considered high priority by Europol (the European Union’s law
enforcement agency) among environmental crimes, due to its economic
significance, the poor status of the eel stock, and the large number of
organisations affected. Related police action and court decisions have been
covered by many news reports during recent years. In addition, illegal eel trade
from range states is an issue of concern for CITES (CITES, 2023). To summarize,
while IUU fisheries certainly exist for glass, yellow and silver eel, there are
insufficient data available to quantify their effect on the total stock size or
status with any level of certainty. Thus, efforts to improve traceability and
the scale of demand will assist enforcement but also allow us to better
understand what proportion of legal catch enters illegal trade, and thus
estimate illegal catch which would inform the characterization of the impacts of
all fisheries on the stock.

## Other landings

All other landings, coming neither from professional or recreational fisheries
were recorded separately. Most of them concern translocation within a river
basin and/or an EMU to mitigate the impact of barriers to migration. Glass eel
translocations (Annex XX) were reported by Ireland (since 1959, by numbers and
mass) and the United Kingdom (since 1996, by mass only). Yellow eel
translocations were reported in Sweden and Ireland (Annex XX) and silver eel
translocations in 5 countries: mainly in Sweden, Ireland and Finland, and to a
lesser extent in Netherlands and Spain (Annex XX).

```{r otherlandingsYt,echo=FALSE, warning=FALSE}

##Table other_landings (nb) for all the countries for Y

filtered_data<-filter_data("other_landings",
        typ = 33,
        life_stage = c("Y"))%>% 
    dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <- group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,3,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1e6)
table<-data.frame(table,total=rowSums(table[,-1, drop = FALSE],na.rm=T))

#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRelY<-table
ka_other_landings_Y <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 6:  other_landings for yellow eel from ", min(year)," to ",max(year)," in millions, reported by countries ", get_country_table(table),".", sep=""))



ka_other_landings_Y <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 11"), paste(": other_landings for yellow eel from ", min(year)," to ",max(year)," in millions, reported by countries ", get_country_table(table),".", sep="")),
              style = "Normal", align_with_table = FALSE)



```

\newline


```{r otherlandingsYf, echo=FALSE, warning=FALSE, fig.cap=titleYrel, fig.height=5, fig.width=10,eval=FALSE}

other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value) / 10^6
other_landings3$eel_cou_code = as.factor(other_landings3$eel_cou_code)
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries) %in% levels(other_landings3$eel_cou_code)]
cou_string <- get_country(data=other_landings3)
titleYrel <- paste0("CHECK THE CAPTION- Reported releases of yellow eel (in millions) per country. ", cou_string,".")

g_other_landings_Y <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + ylab("other_landings (n) in million")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landings_Y)
```



# Releases 

Data have been reported on restocking which includes eels released at the glass
eel phase, either directly (G), after a quarantine (QG), or after a period of
some months of growth in aquaculture (owngrown eels - OG), at the yellow eel (Y) or silver eel
(S) stage. Dekker and Beaulaton (2016) established the start of the eel
restocking back to 1840 and provided a review of available data since that date
that are not included in this report (based on reported data from countries).
They also emphasis the large variety of practices under the term *restocking*.

There are also some releases of mixed life stages: Glass + Yellow eel (G+Y) and
Yellow + Silver eel (Y+S) for Ireland and Spain, but they will not be presented
in this report. Adding to the complexity, displacements of eel can range from a
few meters within the same waterbody (i.e. assisted migration to bypass an
obstacle), to eel being moved between waterbodies and/or EMUs. There are still
inconsistencies and variations in how countries report these displacements.
Therefore, the WGEEL broadly categorizes them as "releases".

## Glass eel releases (G + QG)

Restocking of glass eel (G + QG) peaked during 1980s, followed by a decline to a
low level in 2009 (Figure \@ref(fig:releasekgGQGf)). The amount of restocked
glass eels has increased since 2010 with high numbers in 2014, and from 2018 to
2022. The quantity of glass eels (G + QG) released were
`r round(rel_CY2_G_t)` and `r round(rel_CY1_G_t)` tonnes in
`r CY-2` and `r CY-1` respectively (number of
countries reporting: `r cou_CY2_relG_t` and `r cou_CY1_relG_t`).


\newline


```{r releaseGQGt, echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries for G # 9 is q_release_n

filtered_data<-filter_data("release",
    typ = 9,
    life_stage = c("G", "QG"),
    year=1950:CY)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Table
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,3,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion =1e6)
table<-data.frame(table,total=rowSums(table[,-1, drop=FALSE],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRelG<-table
table1<-table[,c(1,2:8)]
cou_text1 <- get_country_table(table1)
table2<-table[,c(1,9:ncol(table))]
cou_text2 <- get_country_table(table2[,-ncol(table2)])
#ka_release_G <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =
#				paste("Table 5: Release (nb in millions) of glass eels (G and OG)","(",min(year),"-",max(year),")","for",paste(paste(country,collapse=","), ".", sep="")))
ka_release_G1 <- kable(format(table1,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("part a:  Release of glass eel (G) and quarantined glass eel (QG) in millions from ", min(year)," to ",max(year),")",",  reported by countries ", cou_text1," (to be continued for other countries in next table).", sep=""))
ka_release_G2 <- kable(format(table2,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("partb:  Release of glass eel in millions from ", min(year)," to ",max(year),")",",  reported by countries: ", cou_text2, "", sep=""))




ka_release_G1 <- flextable(table1) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 5a"), paste(":  Release of glass eel (G) and quarantined glass eel (QG) in millions from ", min(year)," to ",max(year),")",",  reported by countries ", cou_text1," (to be continued for other countries in next table).", sep="")),
              style = "Normal", align_with_table = FALSE)


ka_release_G2 <- flextable(table2) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 5b"), paste(":  Release of glass eel (G) and quarantined glass eel (QG) in millions from ", min(year)," to ",max(year),")",",  reported by countries ", cou_text2," (to be continued for other countries in next table).", sep="")),
              style = "Normal", align_with_table = FALSE)



```

\newline


```{r releaseGQGf, echo=FALSE, warning=FALSE, fig.cap=titleGrel, fig.height=5, fig.width=10,eval=FALSE}

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value)/10^6 
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
cou_string <- get_country(data=release3)
##Graph
titleGrel <- paste0("Reported releases of glass eel (in millions) per country ", cou_string,"Inset shows years since 2009 at greater resolution.")
g_release_G <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Release (n) in millions")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw()

print(g_release_G)
#g_release_G<-subplot(g_release_G,
#       coeffy=1.6, # no need to increase the scale
#      minyear=2008, 
#     xmin=1987, 
#    xmax= Inf, 
#   ymin=80,
#  ymax=Inf,
# ymaxbox=60)
#print(g_release_G)

```


\newline


```{r releasekgGQGf, echo=FALSE, warning=FALSE, fig.cap=titleGrelkg, fig.height=5, fig.width=10}

##Table release (nb) for all the countries for G # 9 is q_release_kg

filtered_data<-filter_data("release",
    typ = 8,
    life_stage = c("G", "QG"),
    year=1950:CY)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value)/1000 
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(release3$eel_cou_code)]

cou_string <- get_country(data=release3)
##Graph
titleGrelkg <- paste0("Reported releases of glass eel (G + QG, in tonnes) per country ", cou_string,". Inset shows years since 2010 in greater resolution. 2024 and 2023 are provisional data (data are missing from 2024 because not all the countries have reported yet and from 2023 because German data have not been reported yet).")

g_releasekg_G <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Releases in tonnes")+
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw()+
    geom_magnify(from = c(xmin = 2010, xmax = CY, ymin = 0, ymax = 20),
        to = c(xmin=1992, xmax=CY+1, ymin=25, ymax=45), axes="xy")

print(g_releasekg_G)


#print(g_releasekg_G<-subplot(g_releasekg_G,
#       coeffy=1.4, # no need to increase the scale
#      minyear=2008, 
#     xmin=1987, 
#    xmax= Inf, 
#   ymin=36,
#  ymax=Inf,
# ymaxbox=22))
```


\newline


```{r otherlandingsGt, echo=FALSE, warning=FALSE}

##Table other_landings (nb) for all the countries for G # 9 is q_other_landings_n

filtered_data<-filter_data("other_landings",
    typ = 33,
    life_stage = c("G"),
    year=1950:CY)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Table
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,3,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1e6)
table<-data.frame(table,total=rowSums(table[,-1,drop=FALSE],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRelG<-table


ka_other_landings_G <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =
        paste("Other_landings (nb in millions) of glass eels (G and OG)","(",min(year),"-",max(year),")","for",paste(get_country_table(table), ".", sep="")))
#ka_other_landings_G1 <- kable(format(table1,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 5a:  other_landings of glass eel in millions from ", min(year)," to ",max(year),")",",  reported by countries SE Sweden, EE Estonia, LV Latvia, PL Poland, DE Germany, NL Netherlands, BE Belgium(to be continued for other countries in next table).", sep=""))
#ka_other_landings_G2 <- kable(format(table2,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 5b:  other_landings of glass eel in millions from ", min(year)," to ",max(year),")",",  reported by countries: IE Ireland, GB United Kingdom, FR France, ES Spain, IT Italy, GR Greece.", sep=""))



ka_other_landings_G <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 10"), paste(": Other_landings (nb in millions) of glass eels (G and OG)","(",min(year),"-",max(year),")","for",paste(get_country_table(table), ".", sep=""))),
              style = "Normal", align_with_table = FALSE)


```


\newline


```{r otherlandingsGf,echo=FALSE, warning=FALSE, fig.cap=titleGoth, fig.height=5, fig.width=10,eval=FALSE}


##Graph
other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value)/10^6 
other_landings3$eel_cou_code = as.factor(other_landings3$eel_cou_code)
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(other_landings3$eel_cou_code)]
cou_string <- get_country(data=other_landings3)
titleGoth <- paste0("Other landings of glass eel (glass eel caught for transport operations, so not in formerly reported commercial or recreational fisheries) by number in ", cou_string," (values in numbers not provided for UK.)")

g_other_landings_G <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + ylab("other_landings (n) in millions")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landings_G)

```


```{r otherlandingskgGf,echo=FALSE, warning=FALSE, fig.cap=titleGothkg, fig.height=5, fig.width=10,eval=FALSE}

##Table other_landings (nb) for all the countries for G # 9 is q_other_landings_kg

##Table other_landings (nb) for all the countries for G # 9 is q_other_landings_kg

filtered_data<-filter_data("other_landings",
    typ = 32,
    life_stage = c("G"),
    year=1950:CY)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
##Graph
other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value)/1000
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(other_landings3$eel_cou_code)]
cou_string <- get_country(data=other_landings3)
titleGothkg <- paste0("Other landings of glass eel (glass eel caught for translocation operations, so not in formerly reported commercial or recreational fisheries) by mass, in", cou_string,".")
g_other_landingskg_G <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    
    xlab("year") + ylab("other_landings in T")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landingskg_G)
```

\newline


```{r releaseQGt,echo=FALSE, warning=FALSE, eval=FALSE}

##Table release (nb) for all the countries for QG


filtered_data<-filter_data("release",
    typ = 9,
    life_stage = "QG")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){
#   if(length(X)>0){
#     round(sum(X)/10^6,2)
#   }else{
#     sum(c(X,NA)
#     )
#   }}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1e6)
table<-data.frame(table,total=rowSums(table[,-1,drop=FALSE],na.rm=T))

#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRelQG<-table
ka_release_QG <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Releases for quarantined glass eel from ", min(year)," to ",max(year)," in millions, reported by countries SE Sweden, FI Finland.", sep=""))

```

\newline



```{r releaseQGf,echo=FALSE, warning=FALSE, eval=TRUE, fig.cap=titleQGf , fig.height=5, fig.width=10,eval=FALSE}

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
cou_string <- get_country(data=release3)
titleQGf <- paste0("remove me QG are with the glass eel now, countries ", cou_string)

g_release_QG <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("1000 * Release (n)")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_release_QG)

```




```{r releasekgQGf,echo=FALSE, eval=TRUE, warning=FALSE, fig.cap =titleQGf,fig.height=5, fig.width=10,eval=FALSE}

filtered_data<-filter_data("release",
    typ = 8,
    life_stage = "QG")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
cou_string <- get_country(data=release3)
titleQGf <- paste0("remove me QG are with the glass eel now, countries ", cou_string)
g_releasekg_QG <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Release (tonnes)")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_releasekg_QG)

```



## Ongrown eel (OG) and yellow eel (Y) releases


\newline

Releases of ongrown eels are presented in Figure \@ref(fig:releaseOGf). It has
constantly increased since 2000 and reached a maximum in 2022.

Releases of yellow eel are represented in Figure \@ref(fig:releasekgYf). The
quantity of yellow eels (Y) released in `r CY-2` and `r CY-1` was
`r round(rel_CY2_Y_t)` and `r round(rel_CY1_Y_t)` tonnes (number of countries
reporting: `r cou_CY2_relY_t` and `r cou_CY1_relY_t`). 
 
 
 
```{r releaseOGt,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries

filtered_data<-filter_data("release",
    typ = 9,
    life_stage = "OG" 
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,2,2))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1e6)



#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableRelOG<-table
ka_release_OG <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 9: Releases for ongrown glass eel from ", min(year)," to ",max(year)," in millions, reported by countries: ", get_country_table(table),".", sep=""))




ka_release_OG <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 9"), paste("Table 9: Releases for ongrown glass eel from ", min(year)," to ",max(year)," in millions, reported by countries: ", get_country_table(table),".", sep="")),
              style = "Normal", align_with_table = FALSE)



```

\newline

```{r releaseOGf,echo=FALSE, warning=FALSE, fig.cap=titleOGrel, fig.height=5, fig.width=10}


release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(release3$eel_cou_code)]
cou_string <- get_country(data=release3)
titleOGrel <- paste0("Reported releases of ongrown glass eel (OG, in thousands) per country, ", cou_string,". Data for recent years are provisional or incomplete and may change in future data calls. Data reported in numbers since biomass reporting is incomplete.")

g_release_OG <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("1000 * Release (n)")+
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw() 

print(g_release_OG)

```

\newline

```{r releaseYt,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries for Y

filtered_data<-filter_data("release",
    typ = 9,
    life_stage = c("Y"))%>% dplyr::filter(is.na(eel_missvaluequal))

#filtered_data <- filtered_data %>% #dplyr::filter(!(eel_cou_code == 'SE'))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,3,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1e6)
table<-data.frame(table,total=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRelY<-table
ka_release_Y <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Releases for yellow eel from ", min(year)," to ",max(year)," in millions, reported by countries ", get_country_table(table), ".", sep=""))



ka_release_Y <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 6"), paste(": Releases for yellow eel from ", min(year)," to ",max(year)," in millions, reported by countries ", get_country_table(table), ".", sep="")),
              style = "Normal", align_with_table = FALSE)



```

\newline


```{r releaseYf,echo=FALSE, warning=FALSE, fig.cap=titleYrel, fig.height=5, fig.width=10,eval=FALSE}
##Graph

release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 10^6
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
cou_string <- get_country(data=release3)
##Graph
titleYrel <- paste0("Reported releases of yellow eel (in millions) per country ", cou_string," Inset shows the last 15 years in more detail.")
g_release_Y <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Release (n) in million")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

# print(g_release_Y)

print(g_release_Y<-subplot(g_release_Y,
        coeffy=1.4, # no need to increase the scale
        minyear=2008, 
        xmin=-Inf, 
        xmax= 1975, 
        ymin=3,
        ymax=Inf,
        ymaxbox=2.3))
```

\newline

```{r releasekgYf,echo=FALSE, warning=FALSE, fig.cap=titleYrelkg, fig.height=5, fig.width=10}

filtered_data<-filter_data("release",
    typ = 8,
    life_stage = c("Y"))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph

release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(release3$eel_cou_code)]

cou_string <- get_country(data=release3)
titleYrelkg <- paste0("Reported releases of yellow eel (in tons) per country. ", cou_string,". Inset shows the last 15 years in more detail. Data for recent years are provisional or incomplete and may change in future data calls.")

g_releasekg_Y <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + ylab("Release in tonnes")+
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw()+
    geom_magnify(from = c(xmin = 2010, xmax = CY, ymin = 0, ymax = 20),
        to = c(xmin=1900, xmax=1970, ymin=100, ymax=225), axes="xy")

print(g_releasekg_Y)

#print(g_releasekg_Y<-subplot(g_releasekg_Y,
#       coeffy=1, # no need to increase the scale
#      minyear=2008, 
#     xmin=-Inf, 
#    xmax= 1975, 
#   ymin=100,
#  ymax=Inf,
# ymaxbox=50))
```



```{r otherlandingskgYf,echo=FALSE, warning=FALSE, fig.cap=titleYrelkg, fig.height=5, fig.width=10,eval=FALSE}

filtered_data<-filter_data("other_landings",
    typ = 32,
    life_stage = c("Y"))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph

other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value) / 1000
other_landings3$eel_cou_code = as.factor(other_landings3$eel_cou_code)
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(other_landings3$eel_cou_code)]
cou_string <- get_country(data=other_landings3)
titleYrel <- paste0("CHECK caption Reported releases of yellow eel (in tonnes) per country. ", cou_string,".")

g_other_landingskg_Y <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    
    xlab("year") + ylab("other_landings in tonnes")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landingskg_Y)
```



\newline

```{r releasekgOGf,echo=FALSE, warning=FALSE, eval=TRUE, fig.cap =titleQGf, height=5, fig.width=10,eval=FALSE}

filtered_data<-filter_data("release",
    typ = 8,
    life_stage = "OG" 
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
##Graph
##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
cou_string <- get_country(data=release3)
titleQGf <- paste0("remove me OG in tonnes are not in the report, countries ", cou_string)


g_releasekg_OG <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Release (tonnes)")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_releasekg_OG)

```



## Silver eel releases

Silver eel conservation fisheries to "trap and transport" silver eels around
hydro power and pumping stations take place e.g. in Sweden, Finland, Ireland and
the Netherlands. In Greece and France, a proportion of the
silver eels caught by the fishery are recorded as landings and later
released in the Mediterranean Sea.
These are reported as released silver eel (Figure \@ref(fig:releasekgSf)). Spain
has released silver eels from the Encanyissada lagoon. The quantity
of silver eels (S) released in `r CY-2` and
`r CY-1` is `r round(rel_CY2_S_t)` and
`r round(rel_CY1_S_t)` tonnes respectively (number of countries reporting:
`r cou_CY2_relS_t` and `r cou_CY1_relS_t`).

```{r releaseSt,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries and S

filtered_data<-filter_data("release",
    typ = 9,
    life_stage = "S")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,3,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1e6)
table<-data.frame(table,total=rowSums(table[,-1],na.rm=T))

#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRelS<-table
ka_release_S <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 7: Releases for silver eel from ", min(year)," to ",max(year)," in millions, reported by countries: ", get_country_table(table),".", sep=""))



ka_release_S <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 7"), paste(": Releases for silver eel from ", min(year)," to ",max(year)," in millions, reported by countries: ", get_country_table(table),".", sep="")),
              style = "Normal", align_with_table = FALSE)



```

\newline




```{r releaseSf,echo=FALSE, warning=FALSE, fig.cap=titleSrel, fig.height=5, fig.width=10,eval=FALSE}

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(landings3$eel_cou_code)]
cou_string <- get_country(data=release3)
titleSrel <- paste0("Reported releases of silver eel (in thousands) per country, ", cou_string,".")
g_release_S <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + ylab("1000 * Release (n)")+
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw() 

print(g_release_S)
```



```{r releasekgSf,echo=FALSE, warning=FALSE, fig.cap=titleSrelkg, fig.height=5, fig.width=10}

filtered_data<-filter_data("release",
    typ = 8,
    life_stage = "S")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
color_countries4plot <- color_countries4[names(color_countries4)%in%levels(release3$eel_cou_code)]
cou_string <- get_country(data=release3)
titleSrelkg <- paste0("Reported releases of silver eel (in tonnes) per country, ", cou_string,".")

g_releasekg_S <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    xlab("year") + ylab("Release in tonnes")+
    scale_fill_manual("Country",values=color_countries4plot)+
    theme_bw() 

print(g_releasekg_S)
```


\newline

```{r otherlandingsSt,echo=FALSE, warning=FALSE}

##Table other_landings (nb) for all the countries and S

filtered_data<-filter_data("other_landings",
    typ = 33,
    life_stage = "S")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,3,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1e6)
table<-data.frame(table,total=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableRelS<-table
ka_other_landings_S <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 7: other_landings for silver eel from ", min(year)," to ",max(year)," in millions, reported by countries ", get_country_table(table),".", sep=""))



ka_other_landings_S <- flextable(table) |>
  flextable2ICES() |>
  set_caption(as_paragraph(as_b("Table 12"), paste(": other_landings for silver eel from ", min(year)," to ",max(year)," in millions, reported by countries ", get_country_table(table),".", sep="")),
              style = "Normal", align_with_table = FALSE)


```

\newline




```{r otherlandingsSf,echo=FALSE, warning=FALSE, fig.cap=titleotherlandingsSf , fig.height=5, fig.width=10,eval=FALSE}

##Graph
other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value) / 1000
other_landings3$eel_cou_code = as.factor(other_landings3$eel_cou_code)
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(other_landings3$eel_cou_code)]
cou_string <- get_country(data=other_landings3)
titleotherlandingsSf <- paste0("Reported other_landings of silver eel (in thousands) per country, ", cou_string)

g_other_landings_S <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("1000 * other_landings (n)")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landings_S)
```



```{r otherlandingskgSf,echo=FALSE, warning=FALSE, fig.cap=titleotherlandingskgSf, fig.height=5, fig.width=10,eval=FALSE}

filtered_data<-filter_data("other_landings",
    typ = 32,
    life_stage = "S")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value) / 1000
other_landings3$eel_cou_code = as.factor(other_landings3$eel_cou_code)
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(other_landings3$eel_cou_code)]
cou_string <- get_country(data=other_landings3)
titleotherlandingskgSf <- paste0("Reported other_landings of silver eel (in tonnes) per country, ", cou_string)
g_other_landingskg_S <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("other_landings in tonnes")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landingskg_S)
```

\newline







\newline


```{r releaseAllStages,echo=FALSE, warning=FALSE, fig.cap="release all stage, remove me", fig.height=5, fig.width=10,eval=FALSE}

##Table release of all stages for all the countries

filtered_data<-filter_data("release",
    typ = 9,
    life_stage=c("G","Y","QG","OG","YS","S"),
    year_range = 1950:max(year))%>% dplyr::filter(is.na(eel_missvaluequal))
#TODO REMOVE THIS NEXT YEAR
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
lfs<-unique(filtered_data$eel_lfs_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 10^6
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
title <- paste("releases per country,", "habitat =", paste(hty,collapse="+"), "and", "stage =", paste(lfs,collapse="+"))

g_release_all <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Release (n) in millions")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_release_all)
```


```{r releasekgAllStages,echo=FALSE, warning=FALSE, fig.cap="release all stages in kg remove me", fig.height=5, fig.width=10,eval=FALSE}

##Table release of all stages for all the countries

filtered_data<-filter_data("release",
    typ = 8,
    life_stage=c("G","Y","QG","OG","YS","S"),
    year_range = 1950:max(year))%>% dplyr::filter(is.na(eel_missvaluequal))
#TODO REMOVE THIS NEXT YEAR
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
lfs<-unique(filtered_data$eel_lfs_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
release3$eel_cou_code <- droplevels(release3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(release3$eel_cou_code)]
title <- paste("releases per country,", "habitat =", paste(hty,collapse="+"), "and", "stage =", paste(lfs,collapse="+"))

g_releasekg_all <-  ggplot(release3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Release in tonnes")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_releasekg_all)
```



```{r otherlandingsAllStages,echo=FALSE, warning=FALSE, fig.cap="remove me, other landings all stages combined G,Y,QG,OG,YS,S", fig.height=5, fig.width=10,eval=FALSE}

##Table other_landings of all stages for all the countries

filtered_data<-filter_data("other_landings",
    typ = 33,
    life_stage=c("G","Y","YS","S"),
    year_range = 1950:max(year))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
lfs<-unique(filtered_data$eel_lfs_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value) / 10^6
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(other_landings3$eel_cou_code)]
title <- paste("other_landings per country,", "habitat =", paste(hty,collapse="+"), "and", "stage =", paste(lfs,collapse="+"))

g_other_landings_all <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("other_landings (n) in millions")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landings_all)
```


```{r otherlandingskgAllStages,echo=FALSE, warning=FALSE, fig.cap="remove me, other landings kg all stages combined G,Y,QG,OG,YS,S", fig.height=5, fig.width=10,eval=FALSE}

##Table other_landings of all stages for all the countries

filtered_data<-filter_data("other_landings",
    typ = 32,
    life_stage=c("G","Y","QG","OG","YS","S"),
    year_range = 1950:max(year))%>% dplyr::filter(is.na(eel_missvaluequal))
#TODO REMOVE THIS NEXT YEAR
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
lfs<-unique(filtered_data$eel_lfs_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
other_landings3<-grouped_data
other_landings3$eel_value <- as.numeric(other_landings3$eel_value) / 1000
other_landings3$eel_cou_code = as.factor(other_landings3$eel_cou_code)
other_landings3$eel_cou_code<-factor(other_landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
other_landings3$eel_cou_code <- droplevels(other_landings3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(other_landings3$eel_cou_code)]
title <- paste("other_landings per country,", "habitat =", paste(hty,collapse="+"), "and", "stage =", paste(lfs,collapse="+"))

g_other_landingskg_all <-  ggplot(other_landings3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("other_landings in tonnes")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw() 

print(g_other_landingskg_all)
```

# 	Aquaculture

All eel aquaculture currently relies upon wild eel for seeding. WGEEL collect production
data in its yearly data calls, but those data are known to be largely incomplete. In this context,
WGEEL considered that those data are not reliable (see chapter 3 for futher details).  


```{r aquat,echo=FALSE, warning=FALSE}

##Table aquaculture for all the countries

filtered_data<-filter_data("aquaculture",
    typ = 11)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data, geo="country", habitat=FALSE, lfs=FALSE, na.rm=TRUE)

##Table
# fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,2,2))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg, conversion = 1000)
table<-data.frame(table,total=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
table$total<-as.character(table$total)
tableAqua<-table
table1<-table[,c(1,2:8)]
table2<-table[,c(1,9:ncol(table))]
ka_aqua <- kable(format(table,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 10: Aquaculture for all stages in tonnes from ",min(year)," to ",max(year)," reported by countries: SE Sweden, FI Finland, EE Estonia, LT Lithuania, PL Poland, DE Germany, DK Denmark, NL Netherlands, IE Ireland, ES Spain, PT Portugal, IT Italy, GR Greece.", sep=""))
ka_aqua1 <- kable(format(table1,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 10a: Aquaculture for all stages in tonnes from ",min(year)," to ",max(year)," reported by countries: SE Sweden, FI Finland, EE Estonia, LT Lithuania, PL Poland, DE Germany, DK Denmark.(to be continued for other countries in next table)", sep=""))
ka_aqua2 <- kable(format(table2,digt=1,drop0trailing=TRUE),format="pandoc",caption =paste("Table 10b: Aquaculture for all stages in tonnes from ",min(year)," to ",max(year)," reported by countries: NL Netherlands, IE Ireland, ES Spain, PT Portugal, IT Italy, GR Greece.", sep=""))

```

\newline

```{r aquaf,echo=FALSE, warning=FALSE, fig.cap=titleAQ, fig.height=5, fig.width=10, eval=FALSE}

## Graph
aquaculture3<-grouped_data
aquaculture3$eel_value <- as.numeric(aquaculture3$eel_value) / 1000
aquaculture3$eel_cou_code = as.factor(aquaculture3$eel_cou_code)
aquaculture3$eel_cou_code<-factor(aquaculture3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
aquaculture3$eel_cou_code <- droplevels(aquaculture3$eel_cou_code) 
color_countries2 <-	color_countries[names(color_countries)%in%levels(aquaculture3$eel_cou_code)]
cou_string_AQ <- get_country(data=aquaculture3)

title <- paste("Aquaculture per country,","all stages and all habitats")

titleAQ <- paste("Reported aquaculture production of European eel in Europe from 1984 onwards, in tonnes, in ", cou_string_AQ, ".")

g_aquaculture <-  ggplot(aquaculture3) + 
    geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
    #ggtitle(title) + 
    xlab("year") + ylab("Aquaculture (tonnes)")+
    scale_fill_manual("Country",values=color_countries2)+
    theme_bw()  
print(g_aquaculture)

```


\newline


\newline


# Tables

```{r table, echo=FALSE, warning=FALSE, results="asis"}

(ka_com_land_G)
(ka_com_land_YS1)
(ka_com_land_YS2)
(ka_com_land_YS3)
(ka_rec_land_Y1)
(ka_rec_land_Y2)
(ka_rec_land_G)
#print(ka_release_G)
(ka_release_G1)
(ka_release_G2)
(ka_release_Y)
(ka_release_S)
#print(ka_release_QG)
(ka_release_OG)
#print(ka_aqua1)
#print(ka_aqua2)
(ka_other_landings_G)
(ka_other_landings_Y)
(ka_other_landings_S)

```


```{r save_graphs_and_tables,echo=FALSE, warning=FALSE}

#data_directory <- wg_choose.dir(caption = "Where do you want to save the tables and the graphs")
#setwd(data_directory)
#save(vvv,file="vvv.Rdata")
write.csv2(tableComLandG, paste0(tabwd,"Raw_Com_landings_G.csv"),row.names=FALSE)
#write.csv2(tableComLandYS,"Raw_Com_landings_Y_S.csv",row.names=FALSE)
write.csv2(tableRecLandYS, paste0(tabwd,"Raw_Rec_landings_Y_S.csv"),row.names=FALSE)
write.csv2(tablerecLandG, paste0(tabwd,"Raw_Rec_landings_G.csv"),row.names=FALSE)
write.csv2(tableAqua, paste0(tabwd,"Aquaculture_tons.csv"),row.names=FALSE)
write.csv2(tableRelG, paste0(tabwd,"releases_nb_G.csv"),row.names=FALSE)
write.csv2(tableRelS, paste0(tabwd,"releases_nb_S.csv"),row.names=FALSE)
write.csv2(tableRelY, paste0(tabwd,"releases_nb_Y.csv"),row.names=FALSE)
write.csv2(tableRelQG, paste0(tabwd,"releases_nb_QG.csv"),row.names=FALSE)
write.csv2(tableRelOG, paste0(tabwd,"releases_nb_OG.csv"),row.names=FALSE)
write.csv2(tableCorLandYS, paste0(tabwd,"Raw_Corr_Com_landings_Y_S.csv"),row.names=FALSE)


ggsave(paste0(imgwd,"Raw_Com_landings_G.png"), g_raw_Clandings_G, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"Raw_Com_landings_YS.png"), g_raw_Clandings_YS, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"Raw_Rec_landings_G.png"), g_raw_Rlandings_G, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Raw_Rec_landings_YS.png"), g_raw_Rlandings_YS, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Aquaculture.png"), g_aquaculture, device = "png", width = 30, height = 20,
    units = "cm")

ggsave(paste0(imgwd,"Releases_G.png"), g_release_G, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Releaseskg_G.png"), g_releasekg_G, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Releases_Y.png"), g_release_Y, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Releases_kgY.png"), g_releasekg_Y, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Releases_kgS.png"), g_releasekg_S, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Releases_S.png"), g_release_S, device = "png", width = 30, height = 20,  
    units = "cm")
ggsave(paste0(imgwd,"Releases_QG.png"), g_release_QG, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"Releases_OG.png"), g_release_OG, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"Releases_all.png"),g_release_all, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"Raw_Corr_com_landings_YS.png"), g_combined_landings_YS, device = "png", width = 30, height = 20, 
    units = "cm")
# example for svg
#library(svglite)
#svglite(filename=paste0(imgwd,"Corr_com_landings_YS.svg"), width = 12, height = 8)
#print(g_combined_landings_YS)
#dev.off()
ggsave(paste0(imgwd,"Raw_Corr_com_landings_G.png"), g_combined_landings_G, device = "png", width = 30, height = 20, 
    units = "cm")
#svglite(filename=paste0(imgwd,"Corr_com_landings_G.svg"), width = 8, height = 6)    
#print(g_combined_landings_G)
#dev.off()
ggsave(paste0(imgwd,"other_landingskg_S.png"), g_other_landingskg_S, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"other_landings_S.png"), g_other_landings_S, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"other_landingskg_Y.png"), g_other_landingskg_Y, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"other_landingsY.png"), g_other_landings_Y, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"other_landingskg_G.png"), g_other_landingskg_G, device = "png", width = 30, height = 20, 
    units = "cm")
ggsave(paste0(imgwd,"other_landingsG.png"), g_other_landings_G, device = "png", width = 30, height = 20, 
    units = "cm")
```
